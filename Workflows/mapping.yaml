Global_params:
    Default_wait: 10
    Qsub_path: /storage/SGE6U8/bin/lx24-amd64/
    Qsub_q: bioinfo.q
    Qsub_nodes: [node1,node2,node3]
    Qsub_opts:  -V -cwd
    conda:
        path: /gpfs0/bioinfo/apps/Miniconda2/Miniconda_v4.3.21/bin/
        env:    NSF
    module_path: 
        - /path/to/modules2/
Documentation: |
    A workflow for demonstrating the use of mapping modules
    --------------------------------------------------------------
    
    This workflow demonstrates the use of the mapping modules.
    
    Steps:
    1. File merging, trimming and QC.
    2. The reads are mapped to a reference genome with bowtie2, bowtie, bwa mem and bwa sampe.
    3. The alignment files (SAM) are converted to BAM
    4. BedGraph files are created with genomeCoverageBed
    5. wiggle (wig) and BigWig files are created with UCSC_BW_wig module.
    
    ----------------------------------------------------------------

Vars:
    paths:
        trimmo:             /path/to/java -jar /path/to/trimmomatic-0.32.jar
        bowtie:             /path/to/bowtie
        bowtie2:            /path/to/bowtie2
        fastqc:             /path/to/fastqc
        samtools:           /path/to/samtools
        genomeCoverageBed:  /path/to/genomeCoverageBed
        bedtools:           /path/to/bedtools
        kentUtils:          /path/to/kentUtils/bin/
        multiqc:            /path/to/multiqc
        bwa:                /path/to/bwa
    reference:
        ref_genome:         /path/to/ref_genome.fna
        chrom_sizes:        /path/to/ref_genome/ref_genome.chrom.sizes
        bowtie_index:       /path/to/bowtie_index/ref_genome  # This is the prefix of the index
        bowtie2_index:      /path/to/bowtie2_index/ref_genome  # This is the prefix of the index
        bwa_index:          /path/to/bwa_index/ref_genome  # This is the prefix of the index
        
Step_params:
    merge1:
        module:             merge
        script_path:        gzip -cd
    trim1:
        module:             trimmo
        base:               merge1
        script_path:        {Vars.paths.trimmo}
        qsub_params:
            -pe:            shared 20
            node:           [node1,node2]
            queue:          queue.q
        todo:               LEADING:20 TRAILING:20
        redirects:
            -threads:       20
    fqc_trim1:
        module:             fastqc_html
        base:               trim1
        script_path:        {Vars.paths.fastqc}
        qsub_params:
            -pe:            shared 15
        redirects:
            --threads:      15
# ------------------------------------------ Mapping with bowtie
    bwt1:
        module:             bowtie1_mapper
        base:               trim1
        script_path:        {Vars.paths.bowtie}
        qsub_params:
            -pe:            shared 20
        ebwt:               {Vars.reference.bowtie_index}
        ref_genome:         {Vars.reference.ref_genome}
        redirects:
            -p:             20
    sam_bwt1:
        module:             samtools
        base:               bwt1
        script_path:        {Vars.paths.samtools}
        qsub_params:
            -pe:            shared 20
        view:               -buh  -q 30 -@ 20 -F 4
        sort:               -@ 20
        flagstat: 
        index: 
        stats:              --remove-dups
        del_sam: 
        del_unsorted: 
        # conda:
            # path:           /path/to/conda
            # env:            NSF3.5    
    genCovBed_bwt1:
        module:             genomeCoverageBed
        base:               sam_bwt1
        script_path:        {Vars.paths.genomeCoverageBed}
        redirects:
            -bg: 
            -g:             {Vars.reference.chrom_sizes}
    UCSCmapfiles_bwt1:
        module:             UCSC_BW_wig
        base:               genCovBed_bwt1
        script_path:        {Vars.paths.kentUtils}
        bedGraphToBigWig_params: -blockSize 10 -itemsPerSlot 20
        bigWigToWig_params: -chrom X1 -start X2 -end X3
        genome:             {Vars.reference.chrom_sizes}
# ------------------------------------------ Mapping with bowtie2
    bwt2_1:
        module:             bowtie2_mapper
        base:               trim1
        script_path:        {Vars.paths.bowtie2}
        qsub_params:
            -pe:            shared 20
        get_map_log: 
        ref_genome:         {Vars.reference.ref_genome}
        conda:
            path: yoohoo
            env:   gooogogo
            dhksj: khkjhk
        redirects:
            -p:             20
            -q: 
            -x:             {Vars.reference.bowtie2_index}
    sam_bwt2_1:
        module:             samtools
        base:               bwt2_1
        script_path:        {Vars.paths.samtools}
        qsub_params:
            -pe:            shared 20
        view:               -buh  -q 30 -@ 20 -F 4
        sort:               -@ 20
        flagstat: 
        index: 
        stats:              --remove-dups
        del_sam: 
        del_unsorted: 
    genCovBed_bwt2_1:
        module:             genomeCoverageBed
        base:               sam_bwt2_1
        script_path:        '{Vars.paths.bedtools} genomecov'
        redirects:
            -bg: 
            -g:             {Vars.reference.chrom_sizes}
    UCSCmapfiles_bwt2_1:
        module:             UCSC_BW_wig
        base:               genCovBed_bwt2_1
        script_path:        {Vars.paths.kentUtils}
        bedGraphToBigWig_params: -blockSize 10 -itemsPerSlot 20
        bigWigToWig_params: -chrom X1 -start X2 -end X3
        genome:             {Vars.reference.chrom_sizes}
    firstMultQC:
        module:             Multiqc
        base:
            - sam_bwt2_1
            - sam_bwt1
            - fqc_trim1
        script_path:        {Vars.paths.multiqc}
# --------------------------------------- Mapping with BWA 
# ---------------------- mem
    bwa_mem:
        module:             bwa_mapper
        base:               trim1
        script_path:        {Vars.paths.bwa}
        mod:                mem
        qsub_params:
            -pe:            shared 20
        ref_genome:         {Vars.reference.ref_genome}
        ref_index:          {Vars.reference.bwa_index}
        redirects:
            -t:             20
    sam_bwa_mem:
        module:             samtools
        base:               bwa_mem
        script_path:        {Vars.paths.samtools}
        qsub_params:
            -pe:            shared 20
        view:               -buh  -q 30 -@ 20 -F 4
        sort:               -@ 20
        flagstat: 
        index: 
        stats:              --remove-dups
        del_sam: 
        del_unsorted: 
    genCovBed_bwa_mem:
        module:             genomeCoverageBed
        base:               sam_bwa_mem
        script_path:        '{Vars.paths.bedtools} genomecov'
        redirects:
            -bg: 
            -g:             {Vars.reference.chrom_sizes}
    UCSCmapfiles_bwt2_1:
        module:             UCSC_BW_wig
        base:               genCovBed_bwa_mem
        script_path:        {Vars.paths.kentUtils}
        bedGraphToBigWig_params: -blockSize 10 -itemsPerSlot 20
        bigWigToWig_params: -chrom X1 -start X2 -end X3
        genome:             {Vars.reference.chrom_sizes}
# ---------------------- aln - sampe
    bwa_aln_1:
        module:             bwa_mapper
        base:               trim1
        script_path:        {Vars.paths.bwa}
        mod:                aln
        qsub_params:
            -pe:            shared 20
        ref_genome:         {Vars.reference.ref_genome}
        ref_index:          {Vars.reference.bwa_index}
        redirects:
            -t:             20
    bwa_samse_1:
        module:             bwa_mapper
        base:               bwa_aln_1
        script_path:        {Vars.paths.bwa}
        mod:                sampe
        ref_genome:         {Vars.reference.ref_genome}
        ref_index:          {Vars.reference.bwa_index}
