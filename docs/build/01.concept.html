

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>NeatSeq-Flow concept &mdash; neatseq_flow 1.1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="neatseq_flow 1.1.0 documentation" href="index.html"/>
        <link rel="next" title="Building a workflow" href="02.build_WF.html"/>
        <link rel="prev" title="NeatSeq-Flow: A Lightweight Software for Efficient Execution of High Throughput Sequencing Workflows." href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> neatseq_flow
          

          
            
            <img src="_static/NeatSeq_Flow_logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Detailed documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">NeatSeq-Flow concept</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#workflow-construction">Workflow construction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-modules">Adding modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="02.build_WF.html">Building a workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="03.output.html">Output directory structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="06.addnew_module.html">For the programmer - Adding modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="07.monitor.html">Monitor docs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">neatseq_flow</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>NeatSeq-Flow concept</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/01.concept.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="neatseq-flow-concept">
<h1>NeatSeq-Flow concept<a class="headerlink" href="#neatseq-flow-concept" title="Permalink to this headline">¶</a></h1>
<p><strong>Author:</strong> Menachem Sklarz</p>
<p><strong>Affiliation:</strong> <a class="reference external" href="http://bioinfo.bgu.ac.il/bsu/index.htm">Bioinformatics Core Facility</a>, <a class="reference external" href="http://in.bgu.ac.il/en/nibn/Pages/default.aspx">National institute of Biotechnology in the Negev</a>, Ben-Gurion University</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id4">Introduction</a></li>
<li><a class="reference internal" href="#basic-usage" id="id5">Basic usage</a></li>
<li><a class="reference internal" href="#workflow-construction" id="id6">Workflow construction</a></li>
<li><a class="reference internal" href="#adding-modules" id="id7">Adding modules</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#table-of-contents">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Usage of <strong>NeatSeq-Flow</strong> works at three levels:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#basic-usage"><span class="std std-ref">Basic usage</span></a>: A workflow is coded in a parameter file. All the user has to do is create a sample file describing the samples and their associated files. (See <a class="reference internal" href="02.build_WF.html#sample-file-definition"><span class="std std-ref">Sample file definition</span></a>.)</li>
<li><a class="reference internal" href="#workflow-contruction"><span class="std std-ref">Workflow construction</span></a>: Creating a workflow parameter file based on existing modules. The user has to create both a parameter file and a sample file.</li>
<li><a class="reference internal" href="#adding-modules"><span class="std std-ref">Adding modules</span></a>: Creating a workflow based on tools not yet included in <strong>NeatSeq-Flow</strong>. This requires the user to add modules for each program he expects to run.</li>
</ol>
</div>
<div class="section" id="basic-usage">
<span id="id1"></span><h2><a class="toc-backref" href="#table-of-contents">Basic usage</a><a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>Basic usage does not require much.</p>
<ol class="arabic simple">
<li>Copy a ready-made parameter file (you can find some in <code class="docutils literal"><span class="pre">Workflows</span></code> dir in the main <strong>NeatSeq-Flow</strong> directory).</li>
<li>Adjust the script paths to the correct paths on your system.</li>
<li>Create a sample file following the directions in <a class="reference internal" href="02.build_WF.html#sample-file-definition"><span class="std std-ref">Sample file definition</span></a>.</li>
<li>Execute <strong>NeatSeq-Flow</strong> (see <span class="xref std std-ref">Execution_section</span>)</li>
</ol>
</div>
<div class="section" id="workflow-construction">
<span id="workflow-contruction"></span><h2><a class="toc-backref" href="#table-of-contents">Workflow construction</a><a class="headerlink" href="#workflow-construction" title="Permalink to this headline">¶</a></h2>
<p>In order to construct workflows, one needs to combine modules in such a way that files are transferred seamlessly between them.</p>
<p>The module output filenames are organised within <strong>NeatSeq-Flow</strong> in a python dictionary (this dictionary is included in the JSON file in the <code class="docutils literal"><span class="pre">objects</span></code> directory). This dictionary is called <code class="docutils literal"><span class="pre">sample_data</span></code>. The dictionary tracks the locations of the output files from each module, saving each file type in a dedicated slot. For instance, reads are stored in <code class="docutils literal"><span class="pre">readsX</span></code> slots, where <code class="docutils literal"><span class="pre">X</span></code> is either <code class="docutils literal"><span class="pre">F</span></code>, <code class="docutils literal"><span class="pre">R</span></code> or <code class="docutils literal"><span class="pre">S</span></code> for forward-, reverse- and single-end reads, respectively. <em>FASTA</em>, <em>SAM</em> and <em>BAM</em> files, too, have dedicated slots.</p>
<p>A workflow is a combination of module instances that inherit the above-mentioned dictionary from other modules (these are called the <code class="docutils literal"><span class="pre">base</span></code> of the instance). Each module expects to find specific files in specific slots in the dictionary, which should be put there by one of the modules it inherits from, and puts the files its scripts will create in slots in the dictionary. You can see these requirements in the module documentation, in the <em>Requires</em> and <em>Output</em> sections.</p>
<p>Often, the files are sample-specific, such as fastq files. In this case, they are stored in a dedicated sample slot in the dictionary, <em>e.g.</em> <code class="docutils literal"><span class="pre">sample_data[&quot;Sample1&quot;]</span></code>. Project-wide files, such as an assembly created from all the project fastq files, are stored in the main <code class="docutils literal"><span class="pre">sample_data</span></code> dictionary.</p>
<p>Some of the modules take their inputs and put their outputs in the sample-specific slots and some use the project-wide slots. The sample-specific slots are indicated in the documentation as <code class="docutils literal"><span class="pre">sample_data[&lt;sample&gt;]</span></code>. Some modules can do both, and their exact behaviour is either controlled by a module parameter (<em>e.g.</em> <code class="docutils literal"><span class="pre">scope</span></code> in <code class="docutils literal"><span class="pre">bowtie2_mapper</span></code>) or guessed at by the module based on the dictionary structure.</p>
<p>Creating a workflow is then like assembling a puzzle. Each instance of a module must have an ancestor module (<code class="docutils literal"><span class="pre">base</span></code> module) that puts files in the slots required by the module. <em>e.g.</em> when the <code class="docutils literal"><span class="pre">samtools</span></code> module is executed, it expects to find a SAM file in <code class="docutils literal"><span class="pre">sample_data[&lt;sample&gt;][&quot;sam&quot;]</span></code>. It, in turn, produces a BAM and puts it in <code class="docutils literal"><span class="pre">sample_data[&lt;sample&gt;][&quot;bam&quot;]</span></code> for use by other modules downstream.</p>
<p>Sometimes, modules <em>overwrite</em> existing slots. This <strong>does not mean the files will be overwritten</strong>. It only means that access to these slots in downstream modules will refer to the newer files. <em>e.g.</em> the <code class="docutils literal"><span class="pre">trimmo</span></code> module puts its outputs in the same slots as the <code class="docutils literal"><span class="pre">merge</span></code> module. Therefore, a <code class="docutils literal"><span class="pre">fastqc_html</span></code> instance based on the <code class="docutils literal"><span class="pre">merge</span></code> instance will use the files created by <code class="docutils literal"><span class="pre">merge</span></code> while a <code class="docutils literal"><span class="pre">fastqc_html</span></code> instance based on the <code class="docutils literal"><span class="pre">trimmo</span></code> instance will use the files created by <code class="docutils literal"><span class="pre">trimmo</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This might seem complicated, but once you get used to the dictionary structure you will see how flexible the whole thing really is.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Module instances can be based on more than one instance. <em>e.g.</em> if instance <code class="docutils literal"><span class="pre">i</span></code> is based on instances <code class="docutils literal"><span class="pre">j,k</span></code>, it is the same as having <code class="docutils literal"><span class="pre">j</span></code> based on <code class="docutils literal"><span class="pre">k</span></code> and <code class="docutils literal"><span class="pre">i</span></code> based on <code class="docutils literal"><span class="pre">j</span></code>. In other words, if both <code class="docutils literal"><span class="pre">k</span></code> and <code class="docutils literal"><span class="pre">j</span></code> write to the same slot, <code class="docutils literal"><span class="pre">i</span></code> will have access only to the output from <code class="docutils literal"><span class="pre">j</span></code>.</p>
<p class="last">If <code class="docutils literal"><span class="pre">k</span></code> and <code class="docutils literal"><span class="pre">j</span></code> are independent, then basing <code class="docutils literal"><span class="pre">i</span></code> on <code class="docutils literal"><span class="pre">j,k</span></code> enables <code class="docutils literal"><span class="pre">j</span></code> and <code class="docutils literal"><span class="pre">k</span></code> to run in parallel, possibly reducing runtime.</p>
</div>
</div>
<div class="section" id="adding-modules">
<span id="id2"></span><h2><a class="toc-backref" href="#table-of-contents">Adding modules</a><a class="headerlink" href="#adding-modules" title="Permalink to this headline">¶</a></h2>
<p>Adding modules is the most difficult part of creating a workflow. Please make sure a module does not already exist for the program you want to run before trying to create a module.</p>
<p>It is our hope that a community of users will provide access to a wide range of modules, making the process of developing new pipelines more straightforward for non-programmers.</p>
<p>For detailed instructions for writing modules, see <a class="reference internal" href="06.addnew_module.html#for-the-programmer-adding-modules"><span class="std std-ref">For the programmer - Adding modules</span></a>. The idea is to use the <code class="docutils literal"><span class="pre">sample_data</span></code> dictionary for input and output files while leaving as many of the other parameters as possible to the user. This will enable as much flexibility as possible while releaving the user of the need to track input and output files.</p>
<p>For standard file types, you should use the appropriate slots (check out similar modules for proper slots to use).</p>
<table border="1" class="docutils" id="id3">
<caption><span class="caption-text">Slots for commonly used files</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">File type</th>
<th class="head">Scope</th>
<th class="head">Slot</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>fastq</td>
<td>Sample</td>
<td><code class="docutils literal"><span class="pre">sample_data[&lt;sample&gt;]['fastq.F|fastq.R|fastq.S']</span></code></td>
</tr>
<tr class="row-odd"><td>fasta</td>
<td>Sample</td>
<td><code class="docutils literal"><span class="pre">sample_data[&lt;sample&gt;]['fasta.nucl|fasta.prot']</span></code></td>
</tr>
<tr class="row-even"><td>fasta</td>
<td>Project</td>
<td><code class="docutils literal"><span class="pre">sample_data['fasta.nucl|fasta.prot']</span></code></td>
</tr>
<tr class="row-odd"><td>SAM</td>
<td>Sample</td>
<td><code class="docutils literal"><span class="pre">sample_data[&lt;sample&gt;]['sam']</span></code></td>
</tr>
<tr class="row-even"><td>BAM</td>
<td>Sample</td>
<td><code class="docutils literal"><span class="pre">sample_data[&lt;sample&gt;]['bam']</span></code></td>
</tr>
<tr class="row-odd"><td>Aligner index</td>
<td>Sample</td>
<td><code class="docutils literal"><span class="pre">sample_data[&lt;sample&gt;][&lt;aligner</span> <span class="pre">name&gt;_index']</span></code></td>
</tr>
<tr class="row-even"><td>Aligner index</td>
<td>Project</td>
<td><code class="docutils literal"><span class="pre">sample_data[&lt;aligner</span> <span class="pre">name&gt;_index']</span></code></td>
</tr>
<tr class="row-odd"><td>Aligner reference</td>
<td>Sample</td>
<td><code class="docutils literal"><span class="pre">sample_data[&lt;sample&gt;]['reference']</span></code></td>
</tr>
<tr class="row-even"><td>GFF</td>
<td>Sample</td>
<td><code class="docutils literal"><span class="pre">sample_data[&lt;sample&gt;]['gff']</span></code></td>
</tr>
<tr class="row-odd"><td>GFF</td>
<td>Project</td>
<td><code class="docutils literal"><span class="pre">sample_data['gff']</span></code></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>As mentioned above, module instances can be based on more than one instance. <em>i.e.</em> <code class="docutils literal"><span class="pre">i</span></code> can be based on <code class="docutils literal"><span class="pre">j,k</span></code>. It was stated that in this case, if <code class="docutils literal"><span class="pre">j</span></code> and <code class="docutils literal"><span class="pre">k</span></code> instances write to the same slot, <code class="docutils literal"><span class="pre">i</span></code> will have access only to the version created by <code class="docutils literal"><span class="pre">j</span></code>.</p>
<p class="last">However, you can write modules such that <code class="docutils literal"><span class="pre">i</span></code> has access to the same slot both in <code class="docutils literal"><span class="pre">k</span></code> and in <code class="docutils literal"><span class="pre">j</span></code>: Previous versions of the <code class="docutils literal"><span class="pre">sample_data</span></code> dict are stored in the <code class="docutils literal"><span class="pre">base_sample_data</span></code> slot within the <code class="docutils literal"><span class="pre">sample_data</span></code> dict. The <code class="docutils literal"><span class="pre">base_sample_data</span></code> dict is keyed by the base instance name. This can be used to access <em>overwridden</em> versions of files created by instances upstream to the present module.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="02.build_WF.html" class="btn btn-neutral float-right" title="Building a workflow" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="NeatSeq-Flow: A Lightweight Software for Efficient Execution of High Throughput Sequencing Workflows." accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Menachem Sklarz.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>